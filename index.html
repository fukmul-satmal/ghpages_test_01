<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GitHub Pages (Master Repository)</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!--
<script src="https://cdn.auth0.com/js/auth0-spa-js/1.2/auth0-spa-js.production.js"></script>
-->
<script src="https://cdn.auth0.com/js/auth0/9.11/auth0.min.js"></script>
<script src="script.js"></script>
    <style>
      .hidden {
        display: none;
      }
      
      label {
        margin-bottom: 10px;
        display: block;
      }
    </style>

</head>

<body>
<main>
  <h1>GitHub Pages のサンプル (Master Repository)</h1>
  <a href="https://fukmul-satmal.github.io/">__戻る__</a>
  <p id="current_url"></p>
</main>

<button id="btn-login" onclick="loginmodule.login();">Log in</button>
<button id="btn-logout" onclick="loginmodule.logout();">Log out</button>
<button id="btn-getUserByAccessToken" onclick="loginmodule.getUserByAccessToken();">getUser</button>
<button id="btn-getRefreshToken" onclick="loginmodule.getRefreshToken();">getRefreshToken</button>
<div>
  user:<input type="text" id="user" /><br/>
  pass:<input type="text" id="pass" /><br/>
  realm:<input type="text" id="realm" /><br/>
  nonce:<input type="text" id="nonce" /><br/>
  code:<input type="text" id="code" /><br/>
  verifier:<input type="text" id="verifier" /><br/>
  grant_type:<input type="text" id="grant_type" value="authorization_code" /><br/>
  access_token:<input type="text" id="access_token" /><br/>
  refresh_token:<input type="text" id="refresh_token" /><br/>

</div>
<form id="codepost_id" name="codepost">
  <input type="hidden" name="code" value="" />
  <input type="hidden" name="code_verifier" value="" />
  <input type="hidden" name="grant_type" value="authorization_code" />
  <input type="hidden" name="client_id" value="" />
  <input type="hidden" name="redirect_uri" value="" />
</form>
    <!--ログイン後に表示-->
    <div class="hidden" id="gated-content">
      <p>
        You're seeing this content because you're currently
        <strong>logged in</strong>.
      </p>	
      <label>
        Access token: 
        <pre id="ipt-access-token"></pre>
      </label>
      <label>
        User profile:
        <pre id="ipt-user-profile"></pre>
      </label>

      <label>
          User profile Image:
          <img src="" id="ipt-user-profile-image" width="200px">
        </label>
    </div>

<script>
console.log('GitHub Pages Master Repository');

var loginmodule = require('loginmodule');


  var qry = {};
  var qrystr = window.location.href;
  if (!qrystr) {
    console.log("qry is emp.");
  }
  else {
    qrystr = window.location.href;
    qrystr.split('&').forEach(function(qrystr){
      var qryarry = qrystr.split('=');
        qry[qryarry[0]] = qryarry[1];
    });
  }

  if(!qry["id_token"]) {
    console.log("id_token is emp.");
  }
  else {
    console.log("log id_token.");
      var idTokenStr = JSON.stringify(qry["id_token"]);
      idTokenStr.replace(/\\\"/g, '');
      console.log(idTokenStr);

      var base64IdToken = idTokenStr.split('.')[0];
      var idTokenBase64 = base64IdToken.replace(/-/g, '+').replace(/_/g, '/').replace(/\s/g, '');
//      var decodeHeader = JSON.parse(decodeURIComponent(escape(window.atob(idTokenBase64))));
      console.log("log decodeHeader.");
      console.log(base64IdToken);
//      console.log(decodeHeader);

      base64IdToken = idTokenStr.split('.')[1];
      idTokenBase64 = base64IdToken.replace(/-/g, '+').replace(/_/g, '/').replace(/\s/g, '');
      var decodeToken = JSON.parse(decodeURIComponent(escape(window.atob(idTokenBase64))));
      console.log("log decodeToken.");
      console.log(base64IdToken);
      console.log(decodeToken);

      base64IdToken = idTokenStr.split('.')[2];
      idTokenBase64 = base64IdToken.replace(/-/g, '+').replace(/_/g, '/').replace(/\s/g, '');
//      var decodeSig = JSON.parse(decodeURIComponent(escape(window.atob(idTokenBase64))));
      console.log("log decodeSig.");
      console.log(base64IdToken);
//      console.log(decodeSig);
  }

  if(!qry["code"]) {
    console.log("code is emp.");
  }
  else {
    document.getElementById("code").value = qry["code"];
  }


jQuery( function() {
    jQuery( '#current_url' ).text( location.href );
} );

</script>
</body>
</html>